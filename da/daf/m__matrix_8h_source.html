<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gnucap: savant/gnucap/src/m_matrix.h Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gnucap
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">savant/gnucap/src/m_matrix.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/daf/m__matrix_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*$Id: m_matrix.h,v 26.131 2009/11/20 08:22:10 al Exp $ -*- C++ -*-</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2001 Albert Davis</span>
<a name="l00003"></a>00003 <span class="comment"> * Author: Albert Davis &lt;aldavis@gnu.org&gt;</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of &quot;Gnucap&quot;, the Gnu Circuit Analysis Package</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment"> * the Free Software Foundation; either version 3, or (at your option)</span>
<a name="l00010"></a>00010 <span class="comment"> * any later version.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00019"></a>00019 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span>
<a name="l00020"></a>00020 <span class="comment"> * 02110-1301, USA.</span>
<a name="l00021"></a>00021 <span class="comment"> *------------------------------------------------------------------</span>
<a name="l00022"></a>00022 <span class="comment"> * Sparse matrix package</span>
<a name="l00023"></a>00023 <span class="comment"> * Bump and spike - bordered block diagonal pattern</span>
<a name="l00024"></a>00024 <span class="comment"> * -------------------------------------------------</span>
<a name="l00025"></a>00025 <span class="comment"> * To use it (simple method) .....</span>
<a name="l00026"></a>00026 <span class="comment"> * 1. Declare it ...</span>
<a name="l00027"></a>00027 <span class="comment"> *      BSMATRIX&lt;double&gt; a;</span>
<a name="l00028"></a>00028 <span class="comment"> * 2. Then tell it what slots to allocate, in a loop ...</span>
<a name="l00029"></a>00029 <span class="comment"> *      for (all pairs i,j that might exist)</span>
<a name="l00030"></a>00030 <span class="comment"> *         a.iwant(i,j);</span>
<a name="l00031"></a>00031 <span class="comment"> * 3. Then do the actual allocation ...</span>
<a name="l00032"></a>00032 <span class="comment"> *      a.allocate();</span>
<a name="l00033"></a>00033 <span class="comment"> * 4. If you want, you can add an offset to the diagonal ...</span>
<a name="l00034"></a>00034 <span class="comment"> *      a.dezero(gmin);</span>
<a name="l00035"></a>00035 <span class="comment"> * 5. You probably should set a minimum pivot value ...</span>
<a name="l00036"></a>00036 <span class="comment"> *      a.setminpivot(gmin);</span>
<a name="l00037"></a>00037 <span class="comment"> * 6. Fill in the matrix ...</span>
<a name="l00038"></a>00038 <span class="comment"> *      for (all pairs i,j you want to fill in)</span>
<a name="l00039"></a>00039 <span class="comment"> *         a.m(i,j) += data;</span>
<a name="l00040"></a>00040 <span class="comment"> * 7. Then do the LU decomposition ...</span>
<a name="l00041"></a>00041 <span class="comment"> *      a.lu_decomp();</span>
<a name="l00042"></a>00042 <span class="comment"> * 8. Then get the solution by applying the right side vector (v)</span>
<a name="l00043"></a>00043 <span class="comment"> * and doing the fwd and back substitution.</span>
<a name="l00044"></a>00044 <span class="comment"> *      a.fbsub(v);</span>
<a name="l00045"></a>00045 <span class="comment"> * The solution is now in v.</span>
<a name="l00046"></a>00046 <span class="comment"> * -------------------------------------------------</span>
<a name="l00047"></a>00047 <span class="comment"> * To reuse it .....</span>
<a name="l00048"></a>00048 <span class="comment"> * Get rid of the old data ...</span>
<a name="l00049"></a>00049 <span class="comment"> *      a.zero().</span>
<a name="l00050"></a>00050 <span class="comment"> * Restore the offset, if you want ...</span>
<a name="l00051"></a>00051 <span class="comment"> *      a.dezero(gmin);</span>
<a name="l00052"></a>00052 <span class="comment"> * Then fill and solve as before. (steps 6-8)</span>
<a name="l00053"></a>00053 <span class="comment"> * -------------------------------------------------</span>
<a name="l00054"></a>00054 <span class="comment"> * In the above case, LU replaced the matrix and the solution replaced</span>
<a name="l00055"></a>00055 <span class="comment"> * the right side, losing the data.</span>
<a name="l00056"></a>00056 <span class="comment"> * To keep the matrix, and keep the right side ...</span>
<a name="l00057"></a>00057 <span class="comment"> * 1. Declare two matrices ...</span>
<a name="l00058"></a>00058 <span class="comment"> *      BSMATRIX&lt;double&gt; a;</span>
<a name="l00059"></a>00059 <span class="comment"> *      BSMATRIX&lt;double&gt; lu;</span>
<a name="l00060"></a>00060 <span class="comment"> * 2. as before</span>
<a name="l00061"></a>00061 <span class="comment"> * 2a. Say the lu has the same structure as a.</span>
<a name="l00062"></a>00062 <span class="comment"> *      lu.clone(a);</span>
<a name="l00063"></a>00063 <span class="comment"> * 3-5. Allocate both.</span>
<a name="l00064"></a>00064 <span class="comment"> * 6. Fill in &quot;a&quot; only.</span>
<a name="l00065"></a>00065 <span class="comment"> * 7. Do the LU decomposition, keeping a, with result in lu ...</span>
<a name="l00066"></a>00066 <span class="comment"> *      lu.lu_decomp(a, false);</span>
<a name="l00067"></a>00067 <span class="comment"> * 8. Do the f&amp;B sub, keeping b (the right side), with result in x ...</span>
<a name="l00068"></a>00068 <span class="comment"> *      lu.fbsub(x, b);</span>
<a name="l00069"></a>00069 <span class="comment"> * -------------------------------------------------</span>
<a name="l00070"></a>00070 <span class="comment"> * To make a change to the matrix and re-solve ...</span>
<a name="l00071"></a>00071 <span class="comment"> * Apply the change to a ...</span>
<a name="l00072"></a>00072 <span class="comment"> *      for (all changes you want to make)</span>
<a name="l00073"></a>00073 <span class="comment"> *         a.m(i,j) += delta;  a.set_changed(i).set_changed(j)</span>
<a name="l00074"></a>00074 <span class="comment"> * Then solve again .. step 7 above for a full solution,</span>
<a name="l00075"></a>00075 <span class="comment"> * or for an update ...</span>
<a name="l00076"></a>00076 <span class="comment"> *      lu.lu_decomp(a, true);</span>
<a name="l00077"></a>00077 <span class="comment"> * Then do the same step 8 as above.</span>
<a name="l00078"></a>00078 <span class="comment"> * -------------------------------------------------</span>
<a name="l00079"></a>00079 <span class="comment"> * some other functions that might be useful ....</span>
<a name="l00080"></a>00080 <span class="comment"> * reinit(newsize) -- change the size (and lose the contents and structure)</span>
<a name="l00081"></a>00081 <span class="comment"> * size()const -- return the size (# of rows &amp; cols)</span>
<a name="l00082"></a>00082 <span class="comment"> * density()const -- return the matrix density, as a number between 0 and 1</span>
<a name="l00083"></a>00083 <span class="comment"> * sparsity()const -- 1-density</span>
<a name="l00084"></a>00084 <span class="comment"> * -------------------------------------------------</span>
<a name="l00085"></a>00085 <span class="comment"> * individual element access ...</span>
<a name="l00086"></a>00086 <span class="comment"> * 5 access functions are provided.</span>
<a name="l00087"></a>00087 <span class="comment"> * All return lvalues (references to the actual entry).</span>
<a name="l00088"></a>00088 <span class="comment"> * All take 2 args, row and column.  They differ in speed and generality.</span>
<a name="l00089"></a>00089 <span class="comment"> * Since they are used in equations, they all have 1 letter names.</span>
<a name="l00090"></a>00090 <span class="comment"> * s(r,c) -- &quot;safe&quot; -- most general case, with bounds checking</span>
<a name="l00091"></a>00091 <span class="comment"> *      if completely out of bounds, returns trash</span>
<a name="l00092"></a>00092 <span class="comment"> *      if in the matrix but out of band, returns a reference to zero</span>
<a name="l00093"></a>00093 <span class="comment"> *      Changing it will corrupt the matrix.</span>
<a name="l00094"></a>00094 <span class="comment"> *      All others have no bounds checking.</span>
<a name="l00095"></a>00095 <span class="comment"> * m(r,c) -- &quot;matrix&quot; -- known to be within the allocated band</span>
<a name="l00096"></a>00096 <span class="comment"> * u(r,c) -- &quot;upper&quot; -- known to be in the upper triangle. (c&gt;=r)</span>
<a name="l00097"></a>00097 <span class="comment"> * l(r,c) -- &quot;lower&quot; -- known to be in the lower triangle. (r&gt;=c)</span>
<a name="l00098"></a>00098 <span class="comment"> * d(r,c) -- &quot;diagonal&quot; -- known to be on the diagonal. (r==c)</span>
<a name="l00099"></a>00099 <span class="comment"> * Using s() will always work, but will be slower than the other methods.</span>
<a name="l00100"></a>00100 <span class="comment"> * You should use the most restricted function that you know is correct.</span>
<a name="l00101"></a>00101 <span class="comment"> * -------------------------------------------------</span>
<a name="l00102"></a>00102 <span class="comment"> * Other notes ...</span>
<a name="l00103"></a>00103 <span class="comment"> * The numbering starts at 1 (Fortran style).</span>
<a name="l00104"></a>00104 <span class="comment"> * When using &quot;s&quot; access, it is ok to load row and column 0, then ignore it.</span>
<a name="l00105"></a>00105 <span class="comment"> *   This may simplify load functions, at the expense of run speed.</span>
<a name="l00106"></a>00106 <span class="comment"> * &quot;s&quot; will let you change the value of zero,</span>
<a name="l00107"></a>00107 <span class="comment"> *   but you will find out about it later.</span>
<a name="l00108"></a>00108 <span class="comment"> */</span>
<a name="l00109"></a>00109 <span class="comment">//testing=script 2008.09.19</span>
<a name="l00110"></a>00110 <span class="preprocessor">#ifndef M_MATRIX_H</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#define M_MATRIX_H</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00113"></a>00113 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/daf/l__stlextra_8h.html">l_stlextra.h</a>&quot;</span>
<a name="l00114"></a>00114 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00115"></a>00115 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00116"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">00116</a> <span class="keyword">class </span><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX</a> {
<a name="l00117"></a>00117 <span class="keyword">private</span>:
<a name="l00118"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa9e23958383408640de39afc45c8ca00">00118</a>   <span class="keyword">mutable</span> <span class="keywordtype">bool</span>* <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa9e23958383408640de39afc45c8ca00">_changed</a>;<span class="comment">// flag: this node changed value</span>
<a name="l00119"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa16a60cffd961a5934e8edfb44b97186">00119</a>   <span class="keywordtype">int</span>*  <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa16a60cffd961a5934e8edfb44b97186">_lownode</a>;       <span class="comment">// lowest node connecting to this one</span>
<a name="l00120"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ac6a0bb6a8ef80fe885c9d8200e57cc59">00120</a>   T*    <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ac6a0bb6a8ef80fe885c9d8200e57cc59">_space</a>;         <span class="comment">// ptr to actual memory space used</span>
<a name="l00121"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6feb221b5358d94cdb15f71689c8275a">00121</a>   T**   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6feb221b5358d94cdb15f71689c8275a">_rowptr</a>;        <span class="comment">// ptrs to col 0 of every row</span>
<a name="l00122"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a3c7dbad82394258fa2b95dc4b5650e18">00122</a>   T**   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a3c7dbad82394258fa2b95dc4b5650e18">_colptr</a>;        <span class="comment">// ptrs to row 0 of every col</span>
<a name="l00123"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a31e175223b9b91dc19e3871f21d792d0">00123</a>   T**   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a31e175223b9b91dc19e3871f21d792d0">_diaptr</a>;        <span class="comment">// ptrs to diagonal</span>
<a name="l00124"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6d0391fcaa63edaf4a9389cd70f01cbb">00124</a>   <span class="keywordtype">int</span>   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6d0391fcaa63edaf4a9389cd70f01cbb">_nzcount</a>;       <span class="comment">// count of non-zero elements</span>
<a name="l00125"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a4fa4fa83068c974f8dcb25e7b5af1278">00125</a>   <span class="keywordtype">int</span>   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a4fa4fa83068c974f8dcb25e7b5af1278">_size</a>;          <span class="comment">// # of rows and columns</span>
<a name="l00126"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a949a1455b0bf55d4d3c5854ae7656050">00126</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a949a1455b0bf55d4d3c5854ae7656050">_zero</a>;          <span class="comment">// always 0 but not const</span>
<a name="l00127"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aabe685c747e9ae6dfe638f7911c65875">00127</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aabe685c747e9ae6dfe638f7911c65875">_trash</a>;         <span class="comment">// depository for row and col 0, write only</span>
<a name="l00128"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a0d40b9c4eb88116bf5c8eec9d7e2cf00">00128</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a0d40b9c4eb88116bf5c8eec9d7e2cf00">_min_pivot</a>;     <span class="comment">// minimum pivot value</span>
<a name="l00129"></a>00129 <span class="keyword">private</span>:
<a name="l00130"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a84329e5be571fed04acd8355ac3493c1">00130</a>   <span class="keyword">explicit</span>      <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a84329e5be571fed04acd8355ac3493c1">BSMATRIX</a>(<span class="keyword">const</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;</a>&amp;) {<a class="code" href="../../d6/dda/io__trace_8h.html#ab49bb949daee5ad3cf1bb81863d056d6">incomplete</a>();<a class="code" href="../../d6/dda/io__trace_8h.html#a86d08c1b23d67eca942da0ac012d89f3">unreachable</a>();}
<a name="l00131"></a>00131   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aea48daed191954ea4816fe3d0858067e">uninit</a>();
<a name="l00132"></a>00132   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a696d65b78d698e211de7b529398ca44d">init</a>(<span class="keywordtype">int</span> s=0);
<a name="l00133"></a>00133   T&amp;            <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a22142e36cc8f497912979a0a33f88d1c">subtract_dot_product</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>);
<a name="l00134"></a>00134   T&amp;            <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a22142e36cc8f497912979a0a33f88d1c">subtract_dot_product</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>, <span class="keyword">const</span> T&amp; in);
<a name="l00135"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af1e8889c7be11f527e927713cdd8b5ed">00135</a>   <span class="keywordtype">int</span>           <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af1e8889c7be11f527e927713cdd8b5ed">lownode</a>(<span class="keywordtype">int</span> i)<span class="keyword">const     </span>{<span class="keywordflow">return</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa16a60cffd961a5934e8edfb44b97186">_lownode</a>[i];}
<a name="l00136"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aeaef577a0dd2d884aa5ced6ca1d857fe">00136</a>   <span class="keywordtype">bool</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aeaef577a0dd2d884aa5ced6ca1d857fe">is_changed</a>(<span class="keywordtype">int</span> n)<span class="keyword">const  </span>{<span class="keywordflow">return</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa9e23958383408640de39afc45c8ca00">_changed</a>[n];}
<a name="l00137"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abb1c31f9ca1aad20698907c3c3a17528">00137</a>   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abb1c31f9ca1aad20698907c3c3a17528">set_changed</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">bool</span> x = <span class="keyword">true</span>)<span class="keyword">const </span>{<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa9e23958383408640de39afc45c8ca00">_changed</a>[n] = x;}
<a name="l00138"></a>00138 <span class="keyword">public</span>:
<a name="l00139"></a>00139   <span class="keyword">explicit</span>      <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a84329e5be571fed04acd8355ac3493c1">BSMATRIX</a>(<span class="keywordtype">int</span> ss=0);
<a name="l00140"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af5b71d5938a86ed3bd7154b87d720601">00140</a>                 <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af5b71d5938a86ed3bd7154b87d720601">~BSMATRIX</a>()             {<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aea48daed191954ea4816fe3d0858067e">uninit</a>();}
<a name="l00141"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#afa9dea94fb03c05a8010a440b02cb278">00141</a>   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#afa9dea94fb03c05a8010a440b02cb278">reinit</a>(<span class="keywordtype">int</span> ss=0)        {<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aea48daed191954ea4816fe3d0858067e">uninit</a>(); <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a696d65b78d698e211de7b529398ca44d">init</a>(ss);}
<a name="l00142"></a>00142   <span class="comment">//void        clone(const BSMATRIX&lt;T&gt;&amp;);</span>
<a name="l00143"></a>00143   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a70fd98e2e723914cccf9765881e1783d">iwant</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
<a name="l00144"></a>00144   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a14ccdbf69707d013dc81fa63bf5bf717">unallocate</a>();
<a name="l00145"></a>00145   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6fcf5321684e218fb7b064eb443f7a4c">allocate</a>();
<a name="l00146"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a0d729b701f174969c299b5a403e6ed1a">00146</a>   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a0d729b701f174969c299b5a403e6ed1a">reallocate</a>()            {<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a14ccdbf69707d013dc81fa63bf5bf717">unallocate</a>(); <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6fcf5321684e218fb7b064eb443f7a4c">allocate</a>();}
<a name="l00147"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ab1a7453f0f7a63044db16426e88aac95">00147</a>   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ab1a7453f0f7a63044db16426e88aac95">set_min_pivot</a>(<span class="keywordtype">double</span> x) {<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a0d40b9c4eb88116bf5c8eec9d7e2cf00">_min_pivot</a> = x;}
<a name="l00148"></a>00148   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a85e6998c22aa8815bfc0d20f3a68d495">zero</a>();
<a name="l00149"></a>00149   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ad247d623621f98e69ad8d827d0c0b0b4">dezero</a>(T&amp; o);
<a name="l00150"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abbeae21d2480ff1987ab404c0cbd5473">00150</a>   <span class="keywordtype">int</span>           <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abbeae21d2480ff1987ab404c0cbd5473">size</a>()<span class="keyword">const             </span>{<span class="keywordflow">return</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a4fa4fa83068c974f8dcb25e7b5af1278">_size</a>;}
<a name="l00151"></a>00151   <span class="keywordtype">double</span>        <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a391473dad7b0859e793ce90979e9dcf1">density</a>();
<a name="l00152"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">00152</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span>  )<span class="keyword">const    </span>{<span class="keywordflow">return</span> *(<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a31e175223b9b91dc19e3871f21d792d0">_diaptr</a>[r]);}
<a name="l00153"></a>00153 <span class="keyword">private</span>:
<a name="l00154"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">00154</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">u</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)<span class="keyword">const    </span>{<span class="keywordflow">return</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a3c7dbad82394258fa2b95dc4b5650e18">_colptr</a>[c][r];}
<a name="l00155"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">00155</a>   T     <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">l</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)<span class="keyword">const    </span>{<span class="keywordflow">return</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6feb221b5358d94cdb15f71689c8275a">_rowptr</a>[r][-c];}
<a name="l00156"></a>00156   T&amp;    <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c);
<a name="l00157"></a>00157   T&amp;    <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">u</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c);
<a name="l00158"></a>00158   T&amp;    <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">l</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c);
<a name="l00159"></a>00159   T&amp;    <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aabc14869a6772c0485291387f8bfe0a2">m</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c);
<a name="l00160"></a>00160   <span class="comment">//T&amp;  s(int r, int c);</span>
<a name="l00161"></a>00161 <span class="keyword">public</span>:
<a name="l00162"></a>00162   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aca879052c143a6c5e2256e1644758a15">load_diagonal_point</a>(<span class="keywordtype">int</span> i, T value);
<a name="l00163"></a>00163   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a91510d5c9aa63b30f39e0585e20f9d27">load_point</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value);
<a name="l00164"></a>00164   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a958e3b12c11f436fe1f823e1acf91b0c">load_couple</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value);
<a name="l00165"></a>00165   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6a65ef619f9fce5a13f08c7993790bc3">load_symmetric</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value);
<a name="l00166"></a>00166   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a217a395f196e2ca4bd973e2cfe5470d7">load_asymmetric</a>(<span class="keywordtype">int</span> r1, <span class="keywordtype">int</span> r2, <span class="keywordtype">int</span> c1, <span class="keywordtype">int</span> c2, T value);
<a name="l00167"></a>00167   
<a name="l00168"></a>00168   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#add941ee2f90359df8c0f4a90ef26b425">lu_decomp</a>(<span class="keyword">const</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;</a>&amp;, <span class="keywordtype">bool</span> do_partial);
<a name="l00169"></a>00169   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#add941ee2f90359df8c0f4a90ef26b425">lu_decomp</a>();
<a name="l00170"></a>00170   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a2af3a4d7c39872d9d02c72989723389c">fbsub</a>(T* v) <span class="keyword">const</span>;
<a name="l00171"></a>00171   <span class="keywordtype">void</span>          <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a2af3a4d7c39872d9d02c72989723389c">fbsub</a>(T* x, <span class="keyword">const</span> T* b, T* c = NULL) <span class="keyword">const</span>;
<a name="l00172"></a>00172 };
<a name="l00173"></a>00173 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00174"></a>00174 <span class="comment">// private implementations</span>
<a name="l00175"></a>00175 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00176"></a>00176 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00177"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aea48daed191954ea4816fe3d0858067e">00177</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aea48daed191954ea4816fe3d0858067e">BSMATRIX&lt;T&gt;::uninit</a>()
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179   unallocate();
<a name="l00180"></a>00180   <span class="keyword">delete</span> [] _lownode;
<a name="l00181"></a>00181   _lownode = NULL;
<a name="l00182"></a>00182   <span class="keyword">delete</span> [] _changed;
<a name="l00183"></a>00183   _changed = NULL;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00186"></a>00186 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00187"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a696d65b78d698e211de7b529398ca44d">00187</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a696d65b78d698e211de7b529398ca44d">BSMATRIX&lt;T&gt;::init</a>(<span class="keywordtype">int</span> ss)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189   assert(!_lownode);
<a name="l00190"></a>00190   assert(!_colptr);
<a name="l00191"></a>00191   assert(!_rowptr);
<a name="l00192"></a>00192   assert(!_diaptr);
<a name="l00193"></a>00193   assert(!_space);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   assert(_zero == 0.);
<a name="l00196"></a>00196   _min_pivot = _trash = 0.;
<a name="l00197"></a>00197   _nzcount = 0;
<a name="l00198"></a>00198   _size = ss;
<a name="l00199"></a>00199   _lownode = <span class="keyword">new</span> <span class="keywordtype">int</span>[size()+1];
<a name="l00200"></a>00200   assert(_lownode);
<a name="l00201"></a>00201   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;  ii &lt;= size();  ++ii) {
<a name="l00202"></a>00202     _lownode[ii] = ii;
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204   _changed = <span class="keyword">new</span> <span class="keywordtype">bool</span>[size()+1];
<a name="l00205"></a>00205   assert(_changed);
<a name="l00206"></a>00206   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;  ii &lt;= size();  ++ii) {
<a name="l00207"></a>00207     set_changed(ii, <span class="keyword">false</span>);
<a name="l00208"></a>00208   }
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00211"></a>00211 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00212"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a22142e36cc8f497912979a0a33f88d1c">00212</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a22142e36cc8f497912979a0a33f88d1c">BSMATRIX&lt;T&gt;::subtract_dot_product</a>(<span class="keywordtype">int</span> rr, <span class="keywordtype">int</span> cc, <span class="keywordtype">int</span> dd)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   assert(_lownode);
<a name="l00215"></a>00215   <span class="keywordtype">int</span> kk = std::max(_lownode[rr], _lownode[cc]);
<a name="l00216"></a>00216   <span class="keywordtype">int</span> len = dd - kk;
<a name="l00217"></a>00217   T&amp; dot = m(rr, cc);
<a name="l00218"></a>00218   <span class="keywordflow">if</span> (len &gt; 0) {
<a name="l00219"></a>00219     T* row = &amp;(l(rr,kk));
<a name="l00220"></a>00220     T* col = &amp;(u(kk,cc));
<a name="l00221"></a>00221     <span class="comment">/* for (ii = kk;   ii &lt; dd;   ++ii) */</span>
<a name="l00222"></a>00222     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;   ii &lt; len;   ++ii) {
<a name="l00223"></a>00223       dot -= row[-ii] * col[ii];
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225   }<span class="keywordflow">else</span>{
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227   <span class="keywordflow">return</span> dot;
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00230"></a>00230 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00231"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a06820a21a7fac4445a0f5680842e2bac">00231</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a22142e36cc8f497912979a0a33f88d1c">BSMATRIX&lt;T&gt;::subtract_dot_product</a>(<span class="keywordtype">int</span> rr, <span class="keywordtype">int</span> cc, <span class="keywordtype">int</span> dd, <span class="keyword">const</span> T&amp; in)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233   assert(_lownode);
<a name="l00234"></a>00234   <span class="keywordtype">int</span> kk = std::max(_lownode[rr], _lownode[cc]);
<a name="l00235"></a>00235   <span class="keywordtype">int</span> len = dd - kk;
<a name="l00236"></a>00236   T&amp; dot = m(rr, cc);
<a name="l00237"></a>00237   dot = in;
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (len &gt; 0) {
<a name="l00239"></a>00239     T* row = &amp;(l(rr,kk));
<a name="l00240"></a>00240     T* col = &amp;(u(kk,cc));
<a name="l00241"></a>00241     <span class="comment">/* for (ii = kk;   ii &lt; dd;   ++ii) */</span>
<a name="l00242"></a>00242     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;   ii &lt; len;   ++ii) {
<a name="l00243"></a>00243       dot -= row[-ii] * col[ii];
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245   }<span class="keywordflow">else</span>{
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247   <span class="keywordflow">return</span> dot;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00250"></a>00250 <span class="comment">// public implementations</span>
<a name="l00251"></a>00251 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00252"></a>00252 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00253"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af13deebb3deee902f5a66a15aac331a2">00253</a> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a84329e5be571fed04acd8355ac3493c1">BSMATRIX&lt;T&gt;::BSMATRIX</a>(<span class="keywordtype">int</span> ss)
<a name="l00254"></a>00254   :_changed(NULL),
<a name="l00255"></a>00255    _lownode(NULL),
<a name="l00256"></a>00256    _space(NULL),
<a name="l00257"></a>00257    _rowptr(NULL),
<a name="l00258"></a>00258    _colptr(NULL),
<a name="l00259"></a>00259    _diaptr(NULL),
<a name="l00260"></a>00260    _nzcount(0),
<a name="l00261"></a>00261    _size(ss),
<a name="l00262"></a>00262    _zero(0.),
<a name="l00263"></a>00263    _trash(0.),
<a name="l00264"></a>00264    _min_pivot(0.)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266   <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a696d65b78d698e211de7b529398ca44d">init</a>(ss);
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00269"></a>00269 <span class="preprocessor">#if 0</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span><span class="comment">/* clone: copy to self the structure of another BSMATRIX</span>
<a name="l00271"></a>00271 <span class="comment"> * this does not copy the values stored in the matrix</span>
<a name="l00272"></a>00272 <span class="comment"> */</span>
<a name="l00273"></a>00273 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00274"></a>00274 <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;::clone</a>(<span class="keyword">const</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;</a> &amp; aa)
<a name="l00275"></a>00275 {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00276"></a>00276   reinit(aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abbeae21d2480ff1987ab404c0cbd5473">size</a>());
<a name="l00277"></a>00277   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;  ii &lt;= size();  ++ii) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00278"></a>00278     _lownode[ii] = aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af1e8889c7be11f527e927713cdd8b5ed">lownode</a>(ii);
<a name="l00279"></a>00279   }
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 <span class="preprocessor">#endif</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span><span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00283"></a>00283 <span class="comment">/* iwant: indicate that &quot;iwant&quot; to allocate this spot in the matrix</span>
<a name="l00284"></a>00284 <span class="comment"> */</span>
<a name="l00285"></a>00285 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00286"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a70fd98e2e723914cccf9765881e1783d">00286</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a70fd98e2e723914cccf9765881e1783d">BSMATRIX&lt;T&gt;::iwant</a>(<span class="keywordtype">int</span> node1, <span class="keywordtype">int</span> node2)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288   assert(_lownode);
<a name="l00289"></a>00289   assert(node1 &lt;= size());
<a name="l00290"></a>00290   assert(node2 &lt;= size());
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (node1 &lt;= 0  ||  node2 &lt;= 0) {
<a name="l00293"></a>00293     <span class="comment">// node 0 is ground, and doesn&#39;t count as a connection</span>
<a name="l00294"></a>00294     <span class="comment">// negative is invalid, not used but still may be in a node list</span>
<a name="l00295"></a>00295   }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (node1 &lt; _lownode[node2]) {
<a name="l00296"></a>00296     _lownode[node2]=node1;
<a name="l00297"></a>00297   }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (node2 &lt; _lownode[node1]) {
<a name="l00298"></a>00298     _lownode[node1]=node2;
<a name="l00299"></a>00299   }<span class="keywordflow">else</span>{
<a name="l00300"></a>00300   }
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00303"></a>00303 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00304"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a14ccdbf69707d013dc81fa63bf5bf717">00304</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a14ccdbf69707d013dc81fa63bf5bf717">BSMATRIX&lt;T&gt;::unallocate</a>()
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   assert (_zero == 0.);
<a name="l00307"></a>00307   <span class="keyword">delete</span> [] _rowptr;
<a name="l00308"></a>00308   <span class="keyword">delete</span> [] _colptr;
<a name="l00309"></a>00309   <span class="keyword">delete</span> [] _diaptr;
<a name="l00310"></a>00310   <span class="keyword">delete</span> [] _space;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   _rowptr = _colptr = _diaptr = NULL;
<a name="l00313"></a>00313   _space = NULL;
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00316"></a>00316 <span class="comment">/* allocate: really get the space to work</span>
<a name="l00317"></a>00317 <span class="comment"> */</span>
<a name="l00318"></a>00318 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00319"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6fcf5321684e218fb7b064eb443f7a4c">00319</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6fcf5321684e218fb7b064eb443f7a4c">BSMATRIX&lt;T&gt;::allocate</a>()
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321   assert(_lownode);
<a name="l00322"></a>00322   assert(!_colptr);
<a name="l00323"></a>00323   assert(!_rowptr);
<a name="l00324"></a>00324   assert(!_diaptr);
<a name="l00325"></a>00325   assert(!_space);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   _nzcount = 0;
<a name="l00328"></a>00328   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;   ii &lt;= size();   ++ii) {
<a name="l00329"></a>00329     _nzcount += 2 * (ii - _lownode[ii]) + 1;
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   _colptr = <span class="keyword">new</span> T*[size()+1];
<a name="l00333"></a>00333   _rowptr = <span class="keyword">new</span> T*[size()+1];
<a name="l00334"></a>00334   _diaptr = <span class="keyword">new</span> T*[size()+1];
<a name="l00335"></a>00335   _space  = <span class="keyword">new</span> T[_nzcount];
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   assert(_colptr);
<a name="l00338"></a>00338   assert(_rowptr);
<a name="l00339"></a>00339   assert(_diaptr);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   zero();
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   {
<a name="l00344"></a>00344     T* <a class="code" href="../../dc/d2e/plot_8cc.html#af14376ed41e9914dcef75aea015e51c4">point</a> = _space;
<a name="l00345"></a>00345     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;   ii &lt;= size();   ++ii) {
<a name="l00346"></a>00346       _colptr[ii] = point - _lownode[ii];
<a name="l00347"></a>00347       _rowptr[ii] = _colptr[ii] + 2*ii;
<a name="l00348"></a>00348       _diaptr[ii] = _colptr[ii] + ii;
<a name="l00349"></a>00349       point += 2 * (ii - _lownode[ii]) + 1;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00354"></a>00354 <span class="comment">/* zero: wipe the whole array</span>
<a name="l00355"></a>00355 <span class="comment"> */</span>
<a name="l00356"></a>00356 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00357"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a85e6998c22aa8815bfc0d20f3a68d495">00357</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a85e6998c22aa8815bfc0d20f3a68d495">BSMATRIX&lt;T&gt;::zero</a>()
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359   assert(_space);
<a name="l00360"></a>00360   assert(_zero == 0.);
<a name="l00361"></a>00361   _trash = 0.;
<a name="l00362"></a>00362   std::fill_n(_space, _nzcount, 0.);
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00365"></a>00365 <span class="comment">/* dezero: make sure(?) the diagonal is non-zero</span>
<a name="l00366"></a>00366 <span class="comment"> */</span>
<a name="l00367"></a>00367 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00368"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ad247d623621f98e69ad8d827d0c0b0b4">00368</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ad247d623621f98e69ad8d827d0c0b0b4">BSMATRIX&lt;T&gt;::dezero</a>(T&amp; <a class="code" href="../../dd/d35/c__genrat_8cc.html#a129303e4bd38a8cdba722b6238ed56e9">offset</a>)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 1;  ii &lt;= size();  ++ii) {
<a name="l00371"></a>00371     d(ii,ii) += <a class="code" href="../../dd/d35/c__genrat_8cc.html#a129303e4bd38a8cdba722b6238ed56e9">offset</a>;
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00375"></a>00375 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00376"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a391473dad7b0859e793ce90979e9dcf1">00376</a> <span class="keywordtype">double</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a391473dad7b0859e793ce90979e9dcf1">BSMATRIX&lt;T&gt;::density</a>()
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (size() &gt; 0) {
<a name="l00379"></a>00379     assert(_lownode);
<a name="l00380"></a>00380     _nzcount = 0;
<a name="l00381"></a>00381     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0;   ii &lt;= size();   ++ii) {
<a name="l00382"></a>00382       _nzcount += 2 * (ii - _lownode[ii]) + 1;
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(_nzcount-1)/(static_cast&lt;double&gt;(size())*size());
<a name="l00385"></a>00385   }<span class="keywordflow">else</span>{
<a name="l00386"></a>00386     <span class="keywordflow">return</span> 0;
<a name="l00387"></a>00387   }
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00390"></a>00390 <span class="comment">/* d: fast matrix entry access, lvalue</span>
<a name="l00391"></a>00391 <span class="comment"> * It is known that the entry is valid and on the diagonal</span>
<a name="l00392"></a>00392 <span class="comment"> */</span>
<a name="l00393"></a>00393 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00394"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a86733134e7f3ee4cdea1400966cb02ec">00394</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">BSMATRIX&lt;T&gt;::d</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396   assert(_diaptr);
<a name="l00397"></a>00397   assert(r == c);
<a name="l00398"></a>00398   assert(0 &lt;= r);
<a name="l00399"></a>00399   assert(r &lt;= _size);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="keywordflow">return</span> *(_diaptr[r]);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00404"></a>00404 <span class="comment">/* u: fast matrix entry access</span>
<a name="l00405"></a>00405 <span class="comment"> * It is known that the entry is valid and in the upper triangle</span>
<a name="l00406"></a>00406 <span class="comment"> */</span>
<a name="l00407"></a>00407 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00408"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a9e6e0d747bb324da34e0bdf18a528a0b">00408</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">BSMATRIX&lt;T&gt;::u</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410   assert(_colptr);
<a name="l00411"></a>00411   assert(_lownode);
<a name="l00412"></a>00412   assert(0 &lt; r);
<a name="l00413"></a>00413   assert(r &lt;= c);
<a name="l00414"></a>00414   assert(c &lt;= _size);
<a name="l00415"></a>00415   assert(1 &lt;= _lownode[c]);
<a name="l00416"></a>00416   assert(_lownode[c] &lt;= r);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <span class="keywordflow">return</span> _colptr[c][r];
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00421"></a>00421 <span class="comment">/* l: fast matrix entry access</span>
<a name="l00422"></a>00422 <span class="comment"> * It is known that the entry is valid and in the lower triangle</span>
<a name="l00423"></a>00423 <span class="comment"> */</span>
<a name="l00424"></a>00424 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00425"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa818a41912dc5d85beb79bb68667cb20">00425</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">BSMATRIX&lt;T&gt;::l</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427   assert(_rowptr);
<a name="l00428"></a>00428   assert(_lownode);
<a name="l00429"></a>00429   assert(0 &lt; c);
<a name="l00430"></a>00430   assert(c &lt;= r);
<a name="l00431"></a>00431   assert(r &lt;= _size);
<a name="l00432"></a>00432   assert(1 &lt;= _lownode[r]);
<a name="l00433"></a>00433   assert(_lownode[r] &lt;= c);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   <span class="keywordflow">return</span> _rowptr[r][-c];
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00438"></a>00438 <span class="comment">/* m: semi-fast matrix entry access</span>
<a name="l00439"></a>00439 <span class="comment"> * It is known that the entry refers to a valid location</span>
<a name="l00440"></a>00440 <span class="comment"> * but it is not known whether lower, upper, or diagonal</span>
<a name="l00441"></a>00441 <span class="comment"> */</span>
<a name="l00442"></a>00442 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00443"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aabc14869a6772c0485291387f8bfe0a2">00443</a> T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aabc14869a6772c0485291387f8bfe0a2">BSMATRIX&lt;T&gt;::m</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445   <span class="keywordflow">return</span> (c&gt;=r) ? u(r,c) : l(r,c);
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00448"></a>00448 <span class="comment">/* s: general matrix entry access.</span>
<a name="l00449"></a>00449 <span class="comment"> * It is known that the location is strictly in bounds,</span>
<a name="l00450"></a>00450 <span class="comment"> *   but it is not known whether the location actually exists.</span>
<a name="l00451"></a>00451 <span class="comment"> * If access is attempted to a non-allocated location, </span>
<a name="l00452"></a>00452 <span class="comment"> *   it returns a reference to a shared zero variable.</span>
<a name="l00453"></a>00453 <span class="comment"> *   Writing to this zero is not prohibited,</span>
<a name="l00454"></a>00454 <span class="comment"> *   but will corrupt the matrix in a known and testable way.</span>
<a name="l00455"></a>00455 <span class="comment"> * If access is attempted to row 0 or column 0,</span>
<a name="l00456"></a>00456 <span class="comment"> *   it returns a reference to a shared trash variable.</span>
<a name="l00457"></a>00457 <span class="comment"> *   Writing to trash is allowed and encouraged,</span>
<a name="l00458"></a>00458 <span class="comment"> *   but reading it gives a number not useful for anything.</span>
<a name="l00459"></a>00459 <span class="comment"> */</span>
<a name="l00460"></a>00460 <span class="preprocessor">#if 0</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00462"></a>00462 T&amp; <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;::s</a>(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col)
<a name="l00463"></a>00463 {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00464"></a>00464   assert(_lownode);
<a name="l00465"></a>00465   assert(0 &lt;= col);
<a name="l00466"></a>00466   assert(col &lt;= size());
<a name="l00467"></a>00467   assert(0 &lt;= row);
<a name="l00468"></a>00468   assert(row &lt;= size());
<a name="l00469"></a>00469   assert(_zero == 0.);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="keywordflow">if</span> (col == row) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00472"></a>00472     <span class="keywordflow">return</span> d(row,col);
<a name="l00473"></a>00473   }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (col &gt; row) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();     <span class="comment">/* above the diagonal */</span>
<a name="l00474"></a>00474     <span class="keywordflow">if</span> (row == 0) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00475"></a>00475       <span class="keywordflow">return</span> _trash;
<a name="l00476"></a>00476     }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (row &lt; _lownode[col]) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00477"></a>00477       <span class="keywordflow">return</span> _zero;
<a name="l00478"></a>00478     }<span class="keywordflow">else</span>{<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00479"></a>00479       <span class="keywordflow">return</span> u(row,col);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481   }<span class="keywordflow">else</span>{<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();                     <span class="comment">/* below the diagonal */</span>
<a name="l00482"></a>00482     assert(col &lt; row);
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (col == 0) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00484"></a>00484       <span class="keywordflow">return</span> _trash;
<a name="l00485"></a>00485     }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (col &lt; _lownode[row]) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00486"></a>00486       <span class="keywordflow">return</span> _zero;
<a name="l00487"></a>00487     }<span class="keywordflow">else</span>{<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00488"></a>00488       <span class="keywordflow">return</span> l(row,col);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490   }
<a name="l00491"></a>00491   <a class="code" href="../../d6/dda/io__trace_8h.html#a86d08c1b23d67eca942da0ac012d89f3">unreachable</a>();
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 <span class="preprocessor">#endif</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span><span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00495"></a>00495 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00496"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a91510d5c9aa63b30f39e0585e20f9d27">00496</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a91510d5c9aa63b30f39e0585e20f9d27">BSMATRIX&lt;T&gt;::load_point</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value)
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498   <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; j &gt; 0) {
<a name="l00499"></a>00499     set_changed(j);
<a name="l00500"></a>00500     set_changed(i);
<a name="l00501"></a>00501     m(i,j) += value;
<a name="l00502"></a>00502   }<span class="keywordflow">else</span>{
<a name="l00503"></a>00503   }
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00506"></a>00506 <span class="comment">// load_point(i, i, value);</span>
<a name="l00507"></a>00507 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00508"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aca879052c143a6c5e2256e1644758a15">00508</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aca879052c143a6c5e2256e1644758a15">BSMATRIX&lt;T&gt;::load_diagonal_point</a>(<span class="keywordtype">int</span> i, T value)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l00511"></a>00511     set_changed(i);
<a name="l00512"></a>00512     d(i,i) += value;
<a name="l00513"></a>00513   }<span class="keywordflow">else</span>{<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00514"></a>00514   }
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00517"></a>00517 <span class="comment">// load_point(i, j, -value);</span>
<a name="l00518"></a>00518 <span class="comment">// load_point(j, i, -value);</span>
<a name="l00519"></a>00519 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00520"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a958e3b12c11f436fe1f823e1acf91b0c">00520</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a958e3b12c11f436fe1f823e1acf91b0c">BSMATRIX&lt;T&gt;::load_couple</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522   <span class="keywordflow">if</span> (j &gt; 0) {
<a name="l00523"></a>00523     set_changed(j);
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l00525"></a>00525       set_changed(i);
<a name="l00526"></a>00526       m(i,j) -= value;
<a name="l00527"></a>00527       m(j,i) -= value;
<a name="l00528"></a>00528     }<span class="keywordflow">else</span>{
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530   }<span class="keywordflow">else</span>{<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00534"></a>00534 <span class="comment">// load_point(i, i, value); or load_diagonal_point(i, value);</span>
<a name="l00535"></a>00535 <span class="comment">// load_point(j, j, value); or load_diagonal_point(j, value);</span>
<a name="l00536"></a>00536 <span class="comment">// load_point(i, j, -value);</span>
<a name="l00537"></a>00537 <span class="comment">// load_point(j, i, -value);</span>
<a name="l00538"></a>00538 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00539"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6a65ef619f9fce5a13f08c7993790bc3">00539</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a6a65ef619f9fce5a13f08c7993790bc3">BSMATRIX&lt;T&gt;::load_symmetric</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j, T value)
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541   <span class="keywordflow">if</span> (j &gt; 0) {
<a name="l00542"></a>00542     set_changed(j);
<a name="l00543"></a>00543     d(j,j) += value;
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l00545"></a>00545       set_changed(i);
<a name="l00546"></a>00546       d(i,i) += value;
<a name="l00547"></a>00547       m(i,j) -= value;
<a name="l00548"></a>00548       m(j,i) -= value;
<a name="l00549"></a>00549     }<span class="keywordflow">else</span>{
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551   }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l00552"></a>00552     set_changed(i);
<a name="l00553"></a>00553     d(i,i) += value;
<a name="l00554"></a>00554   }<span class="keywordflow">else</span>{
<a name="l00555"></a>00555   }
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00558"></a>00558 <span class="comment">// load_point(r1, c1, value);</span>
<a name="l00559"></a>00559 <span class="comment">// load_point(r2, c2, value);</span>
<a name="l00560"></a>00560 <span class="comment">// load_point(r1, c2, -value);</span>
<a name="l00561"></a>00561 <span class="comment">// load_point(r2, c1, -value);</span>
<a name="l00562"></a>00562 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00563"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a217a395f196e2ca4bd973e2cfe5470d7">00563</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a217a395f196e2ca4bd973e2cfe5470d7">BSMATRIX&lt;T&gt;::load_asymmetric</a>(<span class="keywordtype">int</span> r1,<span class="keywordtype">int</span> r2,<span class="keywordtype">int</span> c1,<span class="keywordtype">int</span> c2,T value)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565   set_changed(c1);
<a name="l00566"></a>00566   set_changed(c2);
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (r1 &gt; 0) {
<a name="l00568"></a>00568     set_changed(r1);
<a name="l00569"></a>00569     <span class="keywordflow">if</span> (c1 &gt; 0) {
<a name="l00570"></a>00570       m(r1,c1) += value;
<a name="l00571"></a>00571     }<span class="keywordflow">else</span>{
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (c2 &gt; 0) {
<a name="l00574"></a>00574       m(r1,c2) -= value;
<a name="l00575"></a>00575     }<span class="keywordflow">else</span>{
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577   }<span class="keywordflow">else</span>{
<a name="l00578"></a>00578   }
<a name="l00579"></a>00579   <span class="keywordflow">if</span> (r2 &gt; 0) {
<a name="l00580"></a>00580     set_changed(r2);
<a name="l00581"></a>00581     <span class="keywordflow">if</span> (c1 &gt; 0) {
<a name="l00582"></a>00582       m(r2,c1) -= value;
<a name="l00583"></a>00583     }<span class="keywordflow">else</span>{
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (c2 &gt; 0) {
<a name="l00586"></a>00586       m(r2,c2) += value;
<a name="l00587"></a>00587     }<span class="keywordflow">else</span>{
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589   }<span class="keywordflow">else</span>{
<a name="l00590"></a>00590   }
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00593"></a>00593 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00594"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aedf6bb694feda84e5a9d4423b178a8c0">00594</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#add941ee2f90359df8c0f4a90ef26b425">BSMATRIX&lt;T&gt;::lu_decomp</a>(<span class="keyword">const</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html">BSMATRIX&lt;T&gt;</a>&amp; aa, <span class="keywordtype">bool</span> do_partial)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596   <span class="keywordtype">int</span> prop = 0;   <span class="comment">/* change propagation indicator */</span>
<a name="l00597"></a>00597   assert(_lownode);
<a name="l00598"></a>00598   assert(aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aa16a60cffd961a5934e8edfb44b97186">_lownode</a>);
<a name="l00599"></a>00599   assert(aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abbeae21d2480ff1987ab404c0cbd5473">size</a>() == size());
<a name="l00600"></a>00600   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mm = 1;   mm &lt;= size();   ++mm) {
<a name="l00601"></a>00601     assert(aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af1e8889c7be11f527e927713cdd8b5ed">lownode</a>(mm) == _lownode[mm]);
<a name="l00602"></a>00602     <span class="keywordtype">int</span> bn = _lownode[mm];
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (!do_partial  ||  aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#aeaef577a0dd2d884aa5ced6ca1d857fe">is_changed</a>(mm)  ||  bn &lt;= prop) {
<a name="l00604"></a>00604       aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#abb1c31f9ca1aad20698907c3c3a17528">set_changed</a>(mm, <span class="keyword">false</span>);
<a name="l00605"></a>00605       prop = mm;
<a name="l00606"></a>00606       <span class="keywordflow">if</span> (bn &lt; mm) {
<a name="l00607"></a>00607         prop = mm;
<a name="l00608"></a>00608         u(bn,mm) = aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">u</a>(bn,mm) / d(bn,bn);
<a name="l00609"></a>00609         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = bn+1;  ii&lt;mm;  ii++) {
<a name="l00610"></a>00610           <span class="comment">/* u(ii,mm) = (aa.u(ii,mm) - dot(ii,mm,ii)) / d(ii,ii); */</span>
<a name="l00611"></a>00611           subtract_dot_product(ii,mm,ii,aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a10256bab48fd8c5bc1b966070ac1a9c3">u</a>(ii,mm)) /= d(ii,ii);
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613         l(mm,bn) = aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">l</a>(mm,bn);
<a name="l00614"></a>00614         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = bn+1;  jj&lt;mm;  jj++) {
<a name="l00615"></a>00615           <span class="comment">/* l(mm,jj) = aa.l(mm,jj) - dot(mm,jj,jj); */</span>
<a name="l00616"></a>00616           subtract_dot_product(mm,jj,jj,aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a7a6cbe61840d69ec6cbca38e46b5ddd5">l</a>(mm,jj));
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618         { <span class="comment">/* jj == mm */</span>
<a name="l00619"></a>00619           <span class="comment">/* d(mm,mm) = aa.d(mm,mm) - dot(mm,mm,mm); then test */</span>
<a name="l00620"></a>00620           <span class="keywordflow">if</span> (subtract_dot_product(mm,mm,mm,aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>(mm,mm)) == 0.) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00621"></a>00621             <a class="code" href="../../d6/de9/io__error_8cc.html#a153585440ba2fdf0696b0085d19a4a7f">error</a>(bWARNING, <span class="stringliteral">&quot;open circuit: internal node %u\n&quot;</span>, mm);
<a name="l00622"></a>00622             d(mm,mm) = _min_pivot;
<a name="l00623"></a>00623           }<span class="keywordflow">else</span>{
<a name="l00624"></a>00624           }
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626       }<span class="keywordflow">else</span>{    <span class="comment">/* bn == mm */</span>
<a name="l00627"></a>00627         d(mm,mm) = aa.<a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#af9ea4af5dd0c8236b00fd62391b28e15">d</a>(mm,mm);
<a name="l00628"></a>00628         <span class="keywordflow">if</span> (d(mm,mm)==0.) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00629"></a>00629           d(mm,mm) = _min_pivot;
<a name="l00630"></a>00630         }<span class="keywordflow">else</span>{
<a name="l00631"></a>00631         }
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633     }<span class="keywordflow">else</span>{
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00638"></a>00638 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00639"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#add941ee2f90359df8c0f4a90ef26b425">00639</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#add941ee2f90359df8c0f4a90ef26b425">BSMATRIX&lt;T&gt;::lu_decomp</a>()
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641   assert(_lownode);
<a name="l00642"></a>00642   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mm = 1;   mm &lt;= size();   ++mm) {
<a name="l00643"></a>00643     <span class="keywordtype">int</span> bn = _lownode[mm];
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (bn &lt; mm) {
<a name="l00645"></a>00645       u(bn,mm) /= d(bn,bn);
<a name="l00646"></a>00646       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii =bn+1;  ii&lt;mm;  ii++) {
<a name="l00647"></a>00647         <span class="comment">/* (m(ii,mm) -= dot(ii,mm,ii)) /= d(ii,ii); */</span>
<a name="l00648"></a>00648         subtract_dot_product(ii,mm,ii) /= d(ii,ii);
<a name="l00649"></a>00649       }
<a name="l00650"></a>00650       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = bn+1;  jj&lt;mm;  jj++) {
<a name="l00651"></a>00651         <span class="comment">/* m(mm,jj) -= dot(mm,jj,jj); */</span>
<a name="l00652"></a>00652         subtract_dot_product(mm,jj,jj);
<a name="l00653"></a>00653       }
<a name="l00654"></a>00654       { <span class="comment">/* jj == mm */</span>
<a name="l00655"></a>00655         <span class="comment">/* m(mm,mm) -= dot(mm,mm,mm); then test */</span>
<a name="l00656"></a>00656         <span class="keywordflow">if</span> (subtract_dot_product(mm,mm,mm) == 0.) {<a class="code" href="../../d6/dda/io__trace_8h.html#aa6032a13c5f0621c16055ada1b7f47ad">untested</a>();
<a name="l00657"></a>00657           <a class="code" href="../../d6/de9/io__error_8cc.html#a153585440ba2fdf0696b0085d19a4a7f">error</a>(bWARNING, <span class="stringliteral">&quot;open circuit: internal node %u\n&quot;</span>, mm);
<a name="l00658"></a>00658           d(mm,mm) = _min_pivot;
<a name="l00659"></a>00659         }<span class="keywordflow">else</span>{
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662     }<span class="keywordflow">else</span>{    <span class="comment">/* bn == mm */</span>
<a name="l00663"></a>00663       <span class="keywordflow">if</span> (d(mm,mm)==0.) {
<a name="l00664"></a>00664         d(mm,mm) = _min_pivot;
<a name="l00665"></a>00665       }<span class="keywordflow">else</span>{
<a name="l00666"></a>00666       }
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668   }
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00671"></a>00671 <span class="comment">/* fbsub: forward and back sub, shared storage</span>
<a name="l00672"></a>00672 <span class="comment"> * v = right side vector, changed in place to solution vector</span>
<a name="l00673"></a>00673 <span class="comment"> */</span>
<a name="l00674"></a>00674 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00675"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a2af3a4d7c39872d9d02c72989723389c">00675</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a2af3a4d7c39872d9d02c72989723389c">BSMATRIX&lt;T&gt;::fbsub</a>(T* v)<span class="keyword"> const</span>
<a name="l00676"></a>00676 <span class="keyword"></span>{
<a name="l00677"></a>00677   assert(_lownode);
<a name="l00678"></a>00678   assert(v);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 1; ii &lt;= size(); ++ii) {        <span class="comment">/* forward substitution */</span>
<a name="l00681"></a>00681     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = _lownode[ii]; jj &lt; ii; ++jj) {
<a name="l00682"></a>00682       v[ii] -= l(ii,jj) * v[jj];
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     v[ii] /= d(ii,ii);
<a name="l00685"></a>00685   }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = size(); jj &gt; 1; --jj) {         <span class="comment">/* back substitution    */</span>
<a name="l00688"></a>00688     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = _lownode[jj]; ii &lt; jj; ++ii) {
<a name="l00689"></a>00689       v[ii] -= u(ii,jj) * v[jj];
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691   }
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00694"></a>00694 <span class="comment">/* fbsub: forward and back sub, separate storage</span>
<a name="l00695"></a>00695 <span class="comment"> * b = right side vector</span>
<a name="l00696"></a>00696 <span class="comment"> * c = intermediate vector after fwd sub</span>
<a name="l00697"></a>00697 <span class="comment"> * x = solution vector</span>
<a name="l00698"></a>00698 <span class="comment"> */</span>
<a name="l00699"></a>00699 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00700"></a><a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#ae4c919fbb7bad00cdcc4b2ac1a848285">00700</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dd1/class_b_s_m_a_t_r_i_x.html#a2af3a4d7c39872d9d02c72989723389c">BSMATRIX&lt;T&gt;::fbsub</a>(T* x, <span class="keyword">const</span> T* b, T* c)<span class="keyword"> const</span>
<a name="l00701"></a>00701 <span class="keyword"></span>{
<a name="l00702"></a>00702   assert(_lownode);
<a name="l00703"></a>00703   assert(x);
<a name="l00704"></a>00704   assert(b);
<a name="l00705"></a>00705   assert(c);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   {
<a name="l00708"></a>00708     <span class="keywordtype">int</span> ii = 1;
<a name="l00709"></a>00709     <span class="keywordflow">for</span> (   ; ii &lt;= size(); ++ii) {
<a name="l00710"></a>00710       <span class="keywordflow">if</span> (b[ii] != 0.) {
<a name="l00711"></a>00711         <span class="keywordflow">break</span>;
<a name="l00712"></a>00712       }<span class="keywordflow">else</span>{
<a name="l00713"></a>00713       }
<a name="l00714"></a>00714       c[ii] = 0.;
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordtype">int</span> first_nz = ii;
<a name="l00718"></a>00718     <span class="keywordflow">for</span> (   ; ii &lt;= size(); ++ii) {             <span class="comment">/* forward substitution */</span>
<a name="l00719"></a>00719       <span class="keywordtype">int</span> low_node = std::max(_lownode[ii], first_nz);
<a name="l00720"></a>00720       c[ii] = b[ii];
<a name="l00721"></a>00721       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = low_node; jj &lt; ii; ++jj) {
<a name="l00722"></a>00722         c[ii] -= l(ii,jj) * c[jj];
<a name="l00723"></a>00723       }
<a name="l00724"></a>00724       c[ii] /= d(ii,ii);
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726   }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <a class="code" href="../../df/d5a/namespacenotstd.html#ac5801402dbd75088d6952da76eab340f">notstd::copy_n</a>(c, size()+1, x);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = size(); jj &gt; 1; --jj) {         <span class="comment">/* back substitution    */</span>
<a name="l00731"></a>00731     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = _lownode[jj]; ii &lt; jj; ++ii) {
<a name="l00732"></a>00732       x[ii] -= u(ii,jj) * x[jj];
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735   x[0] = 0.;
<a name="l00736"></a>00736   <span class="comment">//BUG// some things don&#39;t work unless there is a zero here.</span>
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00739"></a>00739 <span class="comment">/*--------------------------------------------------------------------------*/</span>
<a name="l00740"></a>00740 <span class="preprocessor">#endif</span>
<a name="l00741"></a>00741 <span class="preprocessor"></span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 10 2012 04:09:12 for gnucap by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
